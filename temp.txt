！！！！！！！！！！！！！！！！！！！！！！！
项目地址
https://msasg.visualstudio.com/DefaultCollection/TextToSpeech/_git/TextToSpeechMain
官方文档：
https://docs.microsoft.com/zh-cn/
Azure Pipelines :(Yaml格式）
https://docs.microsoft.com/zh-cn/azure/devops/pipelines/get-started/yaml-pipeline-editor?view=azure-devops
========================================================
D盘空间 除了temp origin original 约15G
可用的windows虚拟机 stcsrv-G64


CoreXT的cache包：https://msasg.visualstudio.com/TextToSpeech/_git/CoreXtPkgs

https://www.zhihu.com/question/444825341 java学习路径

整个build的pipeline   https://msasg.visualstudio.com/DefaultCollection/TextToSpeech/_git/TextToSpeechMain?path=/ci/azure-pipelines.yml

adb shell，Android系统的shell,待学习；

carbon build参考 : https://msasg.visualstudio.com/Skyman/_build/results?buildId=27087930&view=artifacts&pathAsName=false&type=publishedArtifacts
                  D:\Carbon\ci\build-windows.yml

NIO的repo地址： https://speechoutput.visualstudio.com/_git/Customer_NIO 

HH的repo地址：https://speechoutput.visualstudio.com/Customer_HiPhi/_git/Customer_HiPhi

#Build TTS Reader:
1.改..\TTS Reader (Carbon)\TTS Reader (Carbon)  TTS Reader (Carbon).csproj 11行v4.7.2 ;61行 "Microsoft.CognitiveServices.Speech.csharp" ;替换所有1.20.0
2.TTS Reader (Carbon)\TTS Reader (Carbon)\packages.config 改为新版本
3.Form1.cs 改方法名SetSpeechSynthesisVoice 第44 86行
4.TTS Reader (Carbon)\TTS Reader (Carbon)\bin\x64\Debug 里加个Voices文件夹，加Font进去
*加一个nuget.config ??? 好像不用加了直接找到了package

#Build TextToSpeechMain, cmake 
1.TextToSpeechMain\external\onnx_runtime 加onnx包
2.TextToSpeechMain\private\dev\speech\tts\shenzhou\Platforms\VsBuilds\build\cmake\bin\Debug 加个onnx的.dll
3.如果是-D BUILD_TARGET=EmbeddedLegacy或embeded，Font都不能用neural的否则报错

#Android studio 改java jdk版本，file - project structure - sdk location最下面jdk location;


2.21 看git文档 ；测试BYD 调系统时间无法调用在线语音问题的，测具体多久会不行；
2.22 测试Yulin的NDK; 测试th-th model; update sdk in DeviceTTSRelease
2.23 debug carbon(调试dll,在carbon里加断点)；更新版本D:\DeviceTTSRelease\tools\TTS Reader (Carbon)到 1.21，改动见 #Build TTS Reader
2.24 还是debug carbon；测试两句话在Android phone上
2.25 在temp里重新clone，建分支，build；debug 离线tts;build carbon没成功

2.28 帮 yuntong 高合HiPhi： build sample，查看log解决不出声的问题；
3.1 看菜鸟教程 java,看到正则表达式；
NEW TASK: UTest迁移到Windows平台
https://msasg.visualstudio.com/TextToSpeech/_git/TextToSpeechMain/pullrequest/2654672?_a=files xudong的pr
https://msasg.visualstudio.com/TextToSpeech/_git/TextToSpeechMain?path=/ci/Funcational-Rolling-Test.yml Windows平台的pipeline
https://msasg.visualstudio.com/TextToSpeech/_apps/hub/ms.vss-ciworkflow.build-ci-hub?_a=edit-build-definition&id=12421&view=Tab_Tasks Linux平台的pipeline
https://msasg.visualstudio.com/TextToSpeech/_git/PortableTTSTestDrop?path=/utest/testdata UTest的data
旧版pipeline样例 https://msasg.visualstudio.com/TextToSpeech/_apps/hub/ms.vss-ciworkflow.build-ci-hub?_a=edit-build-definition&id=12284
怎样调试UTest: Debug - xxx Debug Properties - Debugging - Working directory 改为.exe的目录 
3.2 UTest相关：看func-roll-test.yml,看cmake;
3.3 学习cmake,看windows和linux的utest的cmakelists; cmake在-DBUILD_TARGET=Embedded编译不过，EmbeddedLegacy才过；
3.4 试图编译过

3.7 utest；测了一遍xudong的，有一个failed，UnitLatticeGeneration; 在根目录下可以embeded编译过，不知道为啥？
3.8 D:\origin\TextToSpeechMain\SpeechXWindows\private\dev\xwindows\xwin.cpp 中的copyfile deletefile movefile; UnitLatticeGeneration通过
utest目录大小写不敏感？
3.9 CompareBinaryFile 很难搞，需要debug进engine；debug UTest: acousticprosodytagger  DNNDecoder
申请一个wifi？
3.10 Customer_几何 那边测了下apk和sample;



cmake -G "Visual Studio 17 2022" -A x64 -DCMAKE_BUILD_TYPE=Debug -DBUILD_TARGET=Embedded -DBUILD_STATIC_LIB=ON -DENABLE_UT=ON -DLomiJA_TARGET_PLATFORM=x64 CMakeLists.txt

cmake -G "Visual Studio 17 2022" -A x64 -DCMAKE_BUILD_TYPE=Debug -DBUILD_TARGET=Embedded -DBUILD_STATIC_LIB=ON -DENABLE_UT=ON -DLomiJA_TARGET_PLATFORM=x64 ../private/dev/speech/tts/shenzhou/Platforms/VsBuilds/build/cmake -B.

set(RepoRoot /D/temp/TextToSpeechMain)
message(STATUS "????RepoRoot=${RepoRoot}")


//改过的xwin.cpp,3.8
#ifdef __GNUC__
#include <unistd.h> //int access(const char *filenpath, int mode)
#elif _MSC_VER
#include<io.h>  // int _access( const char *path, int mode ) 
#endif 
WINBASEAPI
BOOL
WINAPI
CopyFileW(
	_In_ LPCWSTR lpExistingFileName,
	_In_ LPCWSTR lpNewFileName,
	_In_ BOOL bFailIfExists
)
{
	try
	{
		char cNewFileName[MAX_PATH];
		memset(cNewFileName, 0, MAX_PATH);
		int nBytes = WideCharToMultiByte(CP_UTF8, 0, lpNewFileName, wcslen(lpNewFileName), cNewFileName, MAX_PATH, NULL, NULL);
		cNewFileName[nBytes] = 0;

		char cExistingFileName[MAX_PATH];
		memset(cExistingFileName, 0, MAX_PATH);
		nBytes = WideCharToMultiByte(CP_UTF8, 0, lpExistingFileName, wcslen(lpExistingFileName), cExistingFileName, MAX_PATH, NULL, NULL);
		cExistingFileName[nBytes] = 0;

        #ifdef __GNUC__
        if (bFailIfExists && access(cNewFileName, 0))
        {
            return FALSE;
        }
        #elif _MSC_VER
        if (bFailIfExists && _access(cNewFileName, 0))
        {
            return FALSE;
        }
        #endif 
		
		FILE *fp1;
		fp1 = fopen(cExistingFileName, "r");
		FILE *fp2;
		fp2 = fopen(cNewFileName, "w");

		char buff[1024] = { '\0' };
		int count = 0;
		while ((count = fread(buff, 1, 1024, fp1)) != 0)
		{
			fwrite(buff, 1, count, fp2);
		}

		fclose(fp1);
		fclose(fp2);

		return TRUE;
	}
	catch (...)
	{
		return FALSE;
	}
}
